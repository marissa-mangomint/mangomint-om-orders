<!-- DEPLOYED: Feb 11, 2026 6:30 PM - FRESH VERSION -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ğŸ¥­ Mangomint Equipment Orders</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: Georgia, serif; background: linear-gradient(135deg, #fff7ed 0%, #fef3c7 100%); min-height: 100vh; padding: 24px 16px; }
  input, textarea, select, button { font-family: inherit; }
  a { color: inherit; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONSTANTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const OM_NAMES = ["Chelsey","Erynne","Jeelain","Jordan","Ryan","Kayla","Marissa","Amie","Jeanette","Camryn"];

const SHIPPING_OPTIONS = [
  { code: "FREESHIP", label: "Free Shipping",  sub: "Standard",             icon: "ğŸ“¦" },
  { code: "3DAYSHIP", label: "3-Day Shipping", sub: "3 business days",      icon: "ğŸšš" },
  { code: "2DAYSHIP", label: "2-Day Shipping", sub: "2 business days",      icon: "âš¡" },
];

const COLOR_IDS = new Set(["ipad-stand-tall","ipad-stand-short","bundle-tall-us","bundle-short-us","bundle-tall-ca","bundle-short-ca","complete-display-tall","complete-display-short"]);

const VARIANTS = {
  // Complete Front Desk Display: 8 variants â€” US/CA x Tall/Short x Black/White
  "complete-display-us-tall-black":  { default: "42051012034741" },
  "complete-display-us-tall-white":  { default: "42051012067509" },
  "complete-display-us-short-black": { default: "42051012100277" },
  "complete-display-us-short-white": { default: "42051012133045" },
  "complete-display-ca-tall-black":  { default: "42497309737141" },
  "complete-display-ca-tall-white":  { default: "42497309769909" },
  "complete-display-ca-short-black": { default: "42497309802677" },
  "complete-display-ca-short-white": { default: "42497309835445" },
  "card-reader-dock-us": { default: "40037874827445" },
  "card-reader-us":      { default: "40013378715829" },
  "card-reader-ca":      { default: "40020785463477" },
  "ipad-stand-tall":     { Black: "42050714730677", White: "42050714763445" },
  "ipad-stand-short":    { Black: "42050873032885", White: "42050873065653" },
  "bundle-tall-us":      { Black: "42050700345525", White: "42050700378293" },
  "bundle-short-us":     { Black: "42050932834485", White: "42050932867253" },
  "bundle-tall-ca":      { Black: "42050953838773", White: "42050953871541" },
  "bundle-short-ca":     { Black: "42050980544693", White: "42050980577461" },
};

const ALL_PRODUCTS = [
  { id:"complete-display-tall",  name:"Complete Front Desk Display", subtitle:"iPad + tall stand + card reader",  price:589, region:"BOTH", icon:"ğŸ–¥ï¸", badge:"Includes iPad", height:"Tall",
    keywords:["complete front desk","complete display","complete setup","ipad included","with ipad","full setup","full front desk","tall stand","tall display"],
    url:"https://store.mangomint.com/products/complete-front-desk-display" },
  { id:"complete-display-short", name:"Complete Front Desk Display", subtitle:"iPad + short stand + card reader", price:589, region:"BOTH", icon:"ğŸ–¥ï¸", badge:"Includes iPad", height:"Short",
    keywords:["complete front desk short","complete display short","short display","short complete"],
    url:"https://store.mangomint.com/products/complete-front-desk-display" },
  { id:"card-reader-dock-us", name:"Card Reader & Dock",          subtitle:"US â€” Payment Processing",     price:124, region:"US",   icon:"ğŸ’³",
    keywords:["card reader dock","cradle","card reader with dock","reader dock"],
    url:"https://store.mangomint.com/collections/all-hardware/products/mangomint-pay-card-reader-with-cradle-us-only" },
  { id:"card-reader-us",      name:"Card Reader",                  subtitle:"US â€” Payment Processing",     price:99,  region:"US",   icon:"ğŸ“±",
    keywords:["card reader","bluetooth reader","payment reader"],
    url:"https://store.mangomint.com/collections/all-hardware/products/us-bluetooth-card-reader" },
  { id:"card-reader-ca",      name:"Card Reader",                  subtitle:"CA â€” Payment Processing",     price:99,  region:"CA",   icon:"ğŸ“±",
    keywords:["card reader canada","canadian card reader","card reader","bluetooth reader","payment reader"],
    url:"https://store.mangomint.com/collections/all-hardware/products/mangomint-bluetooth-card-reader-canada" },
  { id:"ipad-stand-tall",     name:"iPad Stand (Tall)",            subtitle:"Front Desk Display",          price:149, region:"BOTH", icon:"ğŸ–¥ï¸",
    keywords:["tall stand","ipad stand tall","freestanding","tall ipad","stand tall","tall white stand","white tall stand","tall black stand","black tall stand","tall payment stand","payment stand tall","tall white payment","white payment stand"],
    url:"https://store.mangomint.com/collections/all-hardware/products/front-desk-display-freestanding" },
  { id:"ipad-stand-short",    name:"iPad Stand (Short)",           subtitle:"Front Desk Display",          price:118, region:"BOTH", icon:"ğŸ–¥ï¸",
    keywords:["short stand","ipad stand short","nexus","short ipad","stand short","short white stand","white short stand","short black stand","black short stand"],
    url:"https://store.mangomint.com/collections/all-hardware/products/touch-nexus" },
  { id:"bundle-tall-us",      name:"Front Desk Bundle â€“ Tall",     subtitle:"US â€” Card reader + stand",    price:273, region:"US",   icon:"ğŸ“¦",
    keywords:["bundle tall","front desk bundle tall","tall bundle","bundle"],
    url:"https://store.mangomint.com/collections/all-hardware/products/front-desk-bundle-tall-stand" },
  { id:"bundle-short-us",     name:"Front Desk Bundle â€“ Short",    subtitle:"US â€” Card reader + stand",    price:242, region:"US",   icon:"ğŸ“¦",
    keywords:["bundle short","front desk bundle short","short bundle","bundle"],
    url:"https://store.mangomint.com/collections/all-hardware/products/front-desk-bundle-short-stand" },
  { id:"bundle-tall-ca",      name:"Front Desk Bundle â€“ Tall",     subtitle:"CA â€” Card reader + stand",    price:248, region:"CA",   icon:"ğŸ“¦",
    keywords:["canada bundle tall","bundle tall","bundle"],
    url:"https://store.mangomint.com/collections/all-hardware/products/canada-front-desk-bundle-short-stand" },
  { id:"bundle-short-ca",     name:"Front Desk Bundle â€“ Short",    subtitle:"CA â€” Card reader + stand",    price:217, region:"CA",   icon:"ğŸ“¦",
    keywords:["canada bundle short","bundle short","bundle"],
    url:"https://store.mangomint.com/collections/all-hardware/products/canada-front-desk-bundle-short" },
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function getProducts(region) {
  return ALL_PRODUCTS.filter(p => p.region === region || p.region === "BOTH");
}

function deriveCode(name) {
  if (!name.trim()) return "";
  const first = name.trim().split(/\s+/)[0].toUpperCase().replace(/[^A-Z]/g,"");
  return first ? `${first}MANGOMINT` : "";
}

function parseAddress(raw) {
  if (!raw) return {};
  const cleaned = raw.replace(/\s*\(or [^)]+\)/gi, "").trim();
  const zipUS = cleaned.match(/\b(\d{5})(?:-\d{4})?\b/);
  const zipCA = cleaned.match(/\b([A-Z]\d[A-Z]\s?\d[A-Z]\d)\b/i);
  const zip   = zipUS ? zipUS[1] : zipCA ? zipCA[1].toUpperCase().replace(/\s/,"") : "";
  const stateMatch = cleaned.match(/\b([A-Z]{2})\b(?=\s*[\dA-Z]\d[A-Z]|\s*\d{5}|\s*,|\s*$)/);
  const state = stateMatch ? stateMatch[1] : "";
  const cityMatch = cleaned.match(/([A-Za-z][A-Za-z\s]+?)(?:\s+[A-Z]{2}\b|\s*,\s*[A-Z]{2}\b)/);
  const city  = cityMatch ? cityMatch[1].replace(/,/g,"").trim() : "";
  const street = cleaned
    .replace(/,?\s*[A-Z]{2}\s*\d{5}.*$/, "")
    .replace(/,?\s*[A-Z]{2}\s*[A-Z]\d[A-Z].*$/, "")
    .replace(/,\s*$/, "").trim();
  return { street, city, state, zip, country: zipCA ? "Canada" : "United States" };
}


function buildCartUrl(cartItems, promoCode, shippingCode, address, customerName, email, phone, company, region) {
  const lines = cartItems.map(item => {
    let variantKey = item.id;
    // complete-display has 8 variants: resolve by region + height + color
    if (item.id === "complete-display-tall" || item.id === "complete-display-short") {
      const h = item.id.includes("tall") ? "tall" : "short";
      const c = (item.color || "Black").toLowerCase();
      const r = (region || "US").toLowerCase() === "ca" ? "ca" : "us";
      variantKey = `complete-display-${r}-${h}-${c}`;
    }
    const vm = VARIANTS[variantKey] || {};
    const vid = vm["default"] !== undefined ? vm["default"] : (item.color ? vm[item.color] : null);
    return vid ? `${vid}:${item.qty}` : null;
  }).filter(Boolean);
  if (!lines.length) return null;

  const discounts = [promoCode, shippingCode !== "FREESHIP" ? shippingCode : null].filter(Boolean).join(",");
  const addr = parseAddress(address);
  const note = [
    customerName && `Customer: ${customerName}`,
    address      && `Ship to: ${address}`,
    promoCode    && `Promo: ${promoCode}`,
    shippingCode === "2DAYSHIP" && `âš¡ RUSH SHIPPING REQUESTED â€” please contact support to confirm 2-day delivery`,
    shippingCode === "3DAYSHIP" && `ğŸšš 3-day shipping requested â€” please contact support to confirm`,
    shippingCode !== "FREESHIP" && `Shipping code: ${shippingCode}`,
  ].filter(Boolean).join(" | ");

  const p = new URLSearchParams();
  if (discounts)   p.set("discount", discounts);
  if (note)        p.set("note", note);
  if (addr.street) p.set("checkout[shipping_address][address1]", addr.street);
  if (addr.city)   p.set("checkout[shipping_address][city]",     addr.city);
  if (addr.state)  p.set("checkout[shipping_address][province]", addr.state);
  if (addr.zip)    p.set("checkout[shipping_address][zip]",      addr.zip);
  if (addr.country)p.set("checkout[shipping_address][country]",  addr.country);
  if (email)       p.set("checkout[email]", email);
  if (phone)       p.set("checkout[shipping_address][phone]", phone);
  if (company)     p.set("checkout[shipping_address][company]", company);
  if (customerName) {
    const parts = customerName.trim().split(/\s+/);
    p.set("checkout[shipping_address][first_name]", parts[0] || "");
    p.set("checkout[shipping_address][last_name]",  parts.slice(1).join(" ") || "");
  }
  return `https://store.mangomint.com/cart/${lines.join(",")}?${p.toString()}`;
}

function getMissingItems(cartItems, region) {
  return cartItems.filter(item => {
    let variantKey = item.id;
    if (item.id === "complete-display-tall" || item.id === "complete-display-short") {
      const h = item.id.includes("tall") ? "tall" : "short";
      const c = (item.color || "Black").toLowerCase();
      const r = (region || "US").toLowerCase() === "ca" ? "ca" : "us";
      variantKey = `complete-display-${r}-${h}-${c}`;
    }
    const vm = VARIANTS[variantKey] || {};
    return !(vm["default"] ?? (item.color ? vm[item.color] : null));
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PARSER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function parseTranscript(text, region) {
  const lower = text.toLowerCase();

  // â”€â”€ Detect full transcript vs summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Full transcripts have speaker labels at line start with dialogue after
  // Summary has structured labels like "Key Contact: Name" but not dialogue
  const speakerLines = text.split("\n").filter(line => {
    const m = line.match(/^([A-Z][a-z]+ [A-Z][a-z]+):\s*(.+)/);
    // True speaker line: name followed by conversational text (not just a field value)
    return m && m[2] && m[2].split(" ").length >= 4; // at least 4 words = dialogue
  });
  const isFullTranscript = speakerLines.length >= 3;

  let customerName = "";
  let omName = "";
  let company = "";

  if (isFullTranscript) {
    // Extract unique speakers
    const speakers = [...new Set(speakerLines.map(s => s.replace(":","").trim()))];
    // OM = speaker whose first name is in OM_NAMES
    const omSpeaker = speakers.find(s => OM_NAMES.some(om => s.split(" ")[0].toLowerCase() === om.toLowerCase()));
    // Customer = the other speaker
    const custSpeaker = speakers.find(s => s !== omSpeaker);
    if (omSpeaker)   omName       = omSpeaker.split(" ")[0];
    if (custSpeaker) customerName = custSpeaker;

    // Company: scan customer lines for "spa/salon/studio [Name]" or "[Name] spa/salon"
    if (custSpeaker) {
      const custLines = text.split("\n")
        .filter(l => l.startsWith(custSpeaker + ":"))
        .map(l => l.slice(custSpeaker.length + 1).trim())
        .join(" ");
      // Explicit "we are/we're [Name]" first â€” most reliable
      const weAreMatch = text.match(/[Ww]e(?:'re| are)\s+([A-Z][A-Za-z][A-Za-z\s]{1,28}?)(?:\.|,|\n|$)/m);
      if (weAreMatch) { company = weAreMatch[1].trim(); }
      // "Spa Hoover", "Hoover Spa" â€” only at word boundary after possessive/article noise
      if (!company) {
        const spaMatch =
          text.match(/(?:^|\s)([A-Z][A-Za-z]+\s+(?:Spa|Salon|Studio|Lounge))\b/m) ||
          text.match(/(?:^|\s)(?:Spa|Salon|Studio|Lounge)\s+([A-Z][A-Za-z]+(?:\s+[A-Z][A-Za-z]+)?)\b/m);
        if (spaMatch) company = spaMatch[1] ? spaMatch[1].trim() : spaMatch[0].trim();
      }
    }
  } else {
    // â”€â”€ Summary mode â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Customer name â€” STRICT matching for "* Key Contact: First Last" ONLY
    // Split by line and find the exact "Key Contact:" line
    console.log('[Customer] Searching for Key Contact line...');
    const lines = text.split('\n');
    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];
      console.log('[Customer] Line', i, ':', line.substring(0, 50));
      
      // Must contain "Key Contact:" exactly (not "Key Info" or anything else)
      if (line.includes('Key Contact:')) {
        console.log('[Customer] âœ“ Found Key Contact line');
        // Extract name after "Key Contact:"
        const parts = line.split('Key Contact:');
        if (parts[1]) {
          const afterColon = parts[1].trim();
          console.log('[Customer] Text after colon:', afterColon);
          // Extract first two capitalized words
          const nameMatch = afterColon.match(/^([A-Z][a-z]+)\s+([A-Z][a-z]+)/);
          if (nameMatch) {
            customerName = nameMatch[1] + ' ' + nameMatch[2];
            console.log('[Customer] âœ“ EXTRACTED:', customerName);
            break;
          }
        }
      }
    }

    for (const name of OM_NAMES) {
      if (new RegExp("\\b" + name + "\\b","i").test(text)) { omName = name; break; }
    }
    // Also check "support from [Name]" pattern
    if (!omName) {
      const supportMatch = text.match(/\bsupport from ([A-Z][a-z]+)\b/i);
      if (supportMatch && OM_NAMES.some(n => n.toLowerCase() === supportMatch[1].toLowerCase())) {
        omName = supportMatch[1];
      }
    }
    if (!omName) {
      for (const pat of [
        /\bprepared by[:\s]+([A-Z][a-z]+(?: [A-Z][a-z]+)?)/i,
        /\bOM[:\s]+([A-Z][a-z]+(?: [A-Z][a-z]+)?)/i,
        /\bthis is ([A-Z][a-z]+(?: [A-Z][a-z]+)?)/,
        /\bi(?:'m| am) ([A-Z][a-z]+(?: [A-Z][a-z]+)?)/,
        /\bmy name is ([A-Z][a-z]+(?: [A-Z][a-z]+)?)/i,
        /\b([A-Z][a-z]+) (?:from|with) (?:mangomint|mango mint)/i,
      ]) { const m = text.match(pat); if (m) { omName = m[1].trim(); break; } }
    }

    // Company â€” prioritize "â€“ CompanyName" format, skip summary boilerplate
    const skipWords = ["the","a","an","this","our","your","their","us","we","call","analysis","onboarding","meeting","summary","mangomint","kickoff","title"];
    for (const pat of [
      /^([A-Z][A-Za-z\s'&]+?)\s+Onboarding:/m,  // "Charak Mind Body Wellness Onboarding: OB-1"
      /\|\s+([A-Z][A-Za-z\s'&]+?)\s+(?:â€“|â€”)/,  // "| KALIYA Beauty Lounge â€“"
      /(?:â€“|â€”)\s+([A-Z][A-Za-z\s'&]{3,50}?)(?:\s+â€“|\s+â€”|\n|$)/m,  // "â€“ Spa Hoover"
      /transitioning ([A-Z][A-Za-z\s'&,.]{2,50}?) (?:from|to)\b/i,
      /([A-Z][A-Za-z\s'&]{2,35}?)\s+(?:LLC|Inc|Corp|Studio|Salon|Spa|Lounge|Bar)\b/,
      /\b(?:spa|salon|studio|business|company)[:\s]+([A-Z][A-Za-z\s'&]{2,30}?)(?:\.|,|\n|$)/m,
    ]) {
      const m = text.match(pat);
      if (m) {
        const c = m[1].trim().replace(/[,.]$/,"");
        const firstWord = c.toLowerCase().split(" ")[0];
        // Skip metadata and boilerplate like "Onboarding Kickoff"
        if (!skipWords.includes(firstWord) && !/\b(?:onboarding|kickoff|meeting|call)\b/i.test(c)) {
          company = c;
          break;
        }
      }
    }
  }

  // Products â€” prefer "Order Equipment:" label, then full dialogue for transcripts, then full text
  const detected = [];
  const equipLine = text.match(/Order Equipment[:\s]+([^.\n]+)/i);
  // For full transcripts, scan all lines where equipment is discussed
  // Look for lines mentioning stand/reader/iPad near preference words
  let scanText = lower;
  if (equipLine) {
    scanText = equipLine[1].toLowerCase();
  } else if (isFullTranscript) {
    // Extract lines around equipment discussion â€” "tall/short", "black/white", "stand", "card reader"
    const equipLines = text.split("\n").filter(l =>
      /\b(tall|short|stand|card reader|ipad|black|white|bundle)\b/i.test(l)
    ).join(" ");
    if (equipLines) scanText = equipLines.toLowerCase();
  }
  getProducts(region).forEach(p => {
    if (p.keywords.some(kw => scanText.includes(kw)) && !detected.find(d => d.id === p.id))
      detected.push({ ...p, qty:1, color: COLOR_IDS.has(p.id) ? "Black" : null });
  });

  // Body text equipment mentions: "iPad stand (selected: tall, white)"
  const bodyEquipMatch = text.match(/ipad stand\s*\(selected:\s*([^)]+)\)/i);
  if (bodyEquipMatch) {
    const sel = bodyEquipMatch[1].toLowerCase();
    const isTall  = /tall/i.test(sel);
    const isShort = /short/i.test(sel);
    const isWhite = /white/i.test(sel);
    const standId = isTall ? "ipad-stand-tall" : isShort ? "ipad-stand-short" : null;
    if (standId) {
      const existing = detected.find(d => d.id === standId);
      if (existing) {
        // Update color on existing item
        existing.color = isWhite ? "White" : "Black";
      } else {
        // Add new
        const p = ALL_PRODUCTS.find(p => p.id === standId);
        if (p) detected.push({...p, qty:1, color: isWhite ? "White" : "Black"});
      }
    }
  }

  // iPad + stand combo = Complete Front Desk Display (includes iPad)
  // If equipment line mentions both "ipad" and a stand, swap to complete-display
  if (equipLine) {
    const el = equipLine[1].toLowerCase();
    // For full transcripts, iPad mention may be in OM's lines (e.g. "we'll send you an iPad")
    const mentionsIpad  = /\bipad\b/i.test(el) ||
      (isFullTranscript && /\bipad\b/i.test(text) && /\bstand\b/i.test(scanText));
    const mentionsStand = /\bstand\b/i.test(el) || /\bstand\b/i.test(scanText);
    if (mentionsIpad && mentionsStand) {
      // Remove any standalone stand/bundle items that were detected
      const standIds = ["ipad-stand-tall","ipad-stand-short","bundle-tall-us","bundle-short-us","bundle-tall-ca","bundle-short-ca"];
      standIds.forEach(id => { const i = detected.findIndex(d => d.id===id); if (i>-1) detected.splice(i,1); });
      // Pick tall or short based on equipment line
      const wantsShort = /\bshort\b/i.test(el);
      const cdId = wantsShort ? "complete-display-short" : "complete-display-tall";
      if (!detected.find(d => d.id===cdId)) {
        const cd = ALL_PRODUCTS.find(p => p.id===cdId);
        if (cd) detected.push({...cd, qty:1, color:"Black"});
      }
    }
  }

  // Proximity: tall/short + stand â€” check equipment line first, then full text
  const proxText = scanText;
  if (/\btall\b[\w\s,'".-]{0,25}stand\b/i.test(proxText) && !detected.find(d => d.id==="ipad-stand-tall")) {
    const p = getProducts(region).find(p => p.id==="ipad-stand-tall");
    if (p) detected.push({...p, qty:1, color:"Black"});
  }
  if (/\bshort\b[\w\s,'".-]{0,25}stand\b/i.test(proxText) && !detected.find(d => d.id==="ipad-stand-short")) {
    const p = getProducts(region).find(p => p.id==="ipad-stand-short");
    if (p) detected.push({...p, qty:1, color:"Black"});
  }

  // Quantities
  const wordNums = {one:1,two:2,three:3,four:4,five:5,six:6};
  let m; const qtyRe = /(\d+|one|two|three|four|five|six)\s+(card reader|ipad stand|bundle|stand|reader)/gi;
  while ((m = qtyRe.exec(text)) !== null) {
    const qty = parseInt(m[1]) || wordNums[m[1].toLowerCase()] || 1;
    detected.forEach(d => { if (d.keywords.some(k => k.includes(m[2].toLowerCase()))) d.qty = qty; });
  }

  // Color â€” scan equipment/dialogue lines first, fall back to full text
  const wantsWhite = /\bwhite\b/i.test(scanText);
  const wantsBlack = /\bblack\b/i.test(scanText);
  if (wantsWhite || wantsBlack) {
    detected.forEach(d => {
      if (!COLOR_IDS.has(d.id)) return;
      const isTall  = d.id.includes("tall");
      const isShort = d.id.includes("short");
      if (isTall || isShort) {
        const hw = isTall ? "tall" : "short";
        const nW = new RegExp("(white[\\w\\s,'-]{0,15}"+hw+"|"+hw+"[\\w\\s,'-]{0,15}white)","i").test(text);
        const nB = new RegExp("(black[\\w\\s,'-]{0,15}"+hw+"|"+hw+"[\\w\\s,'-]{0,15}black)","i").test(text);
        if (nW) { d.color="White"; return; }
        if (nB) { d.color="Black"; return; }
      }
      d.color = wantsWhite ? "White" : "Black";
    });
  }

  // Shipping â€” default FREE unless transcript says otherwise
  let shipping = "FREESHIP";
  if (/\b2[ -]?day\b|\btwo[ -]?day\b|\basap\b|\burgent\b/i.test(text)) shipping = "2DAYSHIP";
  else if (/\b3[ -]?day\b|\bthree[ -]?day\b/i.test(text)) shipping = "3DAYSHIP";

  // Address â€” anchored label for summaries; assembled from dialogue for full transcripts
  let address = "";
  const addrM = text.match(/Shipping details[:\s]+([^\n]+)/i);
  if (addrM) {
    // Summary mode: use structured label
    address = addrM[1].trim().replace(/\.+$/, "");
  } else if (isFullTranscript) {
    // Full transcript: assemble from dialogue fragments
    // Street number + street name
    const streetM = text.match(/(\d{3,5}\s+[A-Za-z\s]+(?:Highway|Hwy|Boulevard|Blvd|Street|St|Avenue|Ave|Drive|Dr|Road|Rd|Way|Lane|Ln|Court|Ct))/i);
    // Suite/unit
    const suiteM  = text.match(/suite\s+(\d+)/i);
    // City â€” look for explicit city mentions near zip or "use [City]"
    const cityM   = text.match(/(?:use|in|it'?s?\s+(?:in|at))\s+([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)[,.]?\s+(?:but|either|that|we)/i) ||
                    text.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)\s+is what we use/i);
    // Zip
    const zipM    = text.match(/\b(\d{5})\b/);
    // State â€” 2-letter before zip or standalone
    const stateM  = text.match(/\b([A-Z]{2})\s+\d{5}\b/) ||
                    text.match(/,\s*([A-Z]{2})\s*\d{5}/);
    // State name â†’ abbreviation fallback
    const STATE_NAMES = {alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",
      colorado:"CO",connecticut:"CT",delaware:"DE",florida:"FL",georgia:"GA",hawaii:"HI",
      idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",
      maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",
      missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ",
      "new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",
      oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC",
      "south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",
      washington:"WA","west virginia":"WV",wisconsin:"WI",wyoming:"WY"};
    let stateCode = stateM ? stateM[1] : "";
    if (!stateCode) {
      const lowerText = text.toLowerCase();
      for (const [name, abbr] of Object.entries(STATE_NAMES)) {
        if (lowerText.includes(name)) { stateCode = abbr; break; }
      }
    }
    // Cityâ†’state fallback for known cities mentioned in transcript
    if (!stateCode && /\b(Birmingham|Hoover|Huntsville|Montgomery)\b/i.test(text)) stateCode = "AL";
    if (!stateCode && /\b(Nashville|Memphis|Knoxville)\b/i.test(text)) stateCode = "TN";

    if (streetM) {
      const parts = [streetM[1].trim()];
      if (suiteM)  parts.push("Suite " + suiteM[1]);
      if (cityM)   parts.push(cityM[1].trim());
      if (stateM && zipM) parts.push(stateM[1] + " " + zipM[1]);
      else if (zipM) parts.push(zipM[1]);
      address = parts.join(", ");
    }
  }

  // Email & phone â€” ignore "Not Discussed" placeholders
  const emailM = text.match(/\b([a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,})\b/);
  const phoneRaw = text.match(/(\(?\d{3}\)?[\s.\-]?\d{3}[\s.\-]?\d{4})/);
  const parsedPhone = phoneRaw && !/^\d{2}\/\d{2}\/\d{4}$/.test(phoneRaw[1].trim()) ? phoneRaw[1].trim() : "";

  console.log('[parseTranscript] customerName:', customerName, '| company:', company, '| omName:', omName);
  return { detected, address, omName, customerName, company, shipping,
           parsedEmail: emailM ? emailM[1] : "",
           parsedPhone };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SMALL COMPONENTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function ColorDot({ color }) {
  return <span style={{display:"inline-block",width:10,height:10,borderRadius:"50%",
    background:color==="Black"?"#1c1917":"#f5f5f4",
    border:color==="White"?"1px solid #d1d5db":"none",
    verticalAlign:"middle",flexShrink:0}}/>;
}

function Field({ label, children, hint }) {
  return (
    <div style={{marginBottom:14,flex:1}}>
      <label style={{display:"block",fontSize:11,fontWeight:700,color:"#374151",
        marginBottom:5,fontFamily:"sans-serif",textTransform:"uppercase",letterSpacing:"0.4px"}}>
        {label}
      </label>
      {children}
      {hint && <div style={{fontSize:11,color:"#9ca3af",marginTop:3,fontFamily:"sans-serif"}}>{hint}</div>}
    </div>
  );
}

function Input({ style={}, ...props }) {
  const base = {width:"100%",border:"1.5px solid #e5e7eb",borderRadius:8,
    padding:"9px 12px",fontSize:14,fontFamily:"sans-serif",color:"#1c1917",outline:"none"};
  return <input style={{...base,...style}} {...props}/>;
}

function RegionToggle({ region, onChange, locked }) {
  return (
    <div style={{maxWidth:720,margin:"0 auto 16px",display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}}>
      <span style={{fontSize:11,fontWeight:700,color:"#9ca3af",fontFamily:"sans-serif",
        textTransform:"uppercase",letterSpacing:"0.5px"}}>Region:</span>
      {["US","CA"].map(r => (
        <button key={r} disabled={locked} onClick={() => !locked && onChange(r)} style={{
          display:"flex",alignItems:"center",gap:6,padding:"6px 18px",borderRadius:999,fontSize:13,
          fontFamily:"sans-serif",fontWeight:region===r?700:500,cursor:locked?"default":"pointer",
          border:region===r?"2px solid #f97316":"1.5px solid #e5e7eb",
          background:region===r?"#fff7ed":"#fff",color:region===r?"#f97316":"#6b7280",
        }}>{r==="US"?"ğŸ‡ºğŸ‡¸ United States":"ğŸ‡¨ğŸ‡¦ Canada"}</button>
      ))}
      {!locked && <span style={{fontSize:11,color:"#d1d5db",fontFamily:"sans-serif"}}>Switching resets the order</span>}
    </div>
  );
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MAIN APP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function App() {
  const [region,       setRegion]       = useState("US");
  const [step,         setStep]         = useState(0); // 0=transcript, 1=review, 2=order sheet
  const [transcript,   setTranscript]   = useState("");
  const [cart,         setCart]         = useState([]);
  const [address,      setAddress]      = useState("");
  const [omName,       setOmName]       = useState("");
  const [omManual,     setOmManual]     = useState(false);
  const [customerName, setCustomerName] = useState("");
  const [company,      setCompany]      = useState("");
  const [email,        setEmail]        = useState("");
  const [phone,        setPhone]        = useState("");
  const [codeOverride, setCodeOverride] = useState("");
  const [codeManual,   setCodeManual]   = useState(false);
  const [shipping,     setShipping]     = useState("FREESHIP");
  const [notes,        setNotes]        = useState("");
  const [parseError,   setParseError]   = useState("");

  const displayCode = codeManual ? codeOverride : deriveCode(omName);
  const codeValid   = displayCode.trim().toUpperCase().endsWith("MANGOMINT") && displayCode.trim().length > 9;
  const total       = cart.reduce((s,i) => s + i.price * i.qty, 0);
  const cartUrl     = buildCartUrl(cart, displayCode, shipping, address, customerName, email, phone, company, region);
  const missingItems= getMissingItems(cart, region);
  const canProceed  = cart.length > 0 && address.trim() && codeValid;

  const shippingObj = SHIPPING_OPTIONS.find(s => s.code === shipping) || SHIPPING_OPTIONS[0];

  const handleRegionSwitch = r => {
    setRegion(r); setCart([]); setStep(0); setTranscript(""); setAddress(""); setParseError("");
  };

  const handleParse = () => {
    if (!transcript.trim()) { setParseError("Please paste a transcript or describe what's needed."); return; }
    setParseError("");
    const r = parseTranscript(transcript, region);
    setCart(r.detected);
    setAddress(r.address || "");
    if (r.omName && !omManual)  { setOmName(r.omName); setCodeManual(false); }
    if (r.customerName) setCustomerName(r.customerName);
    if (r.company)      setCompany(r.company);
    if (r.shipping)     setShipping(r.shipping);
    if (r.parsedEmail)  setEmail(r.parsedEmail);
    if (r.parsedPhone)  setPhone(r.parsedPhone);
    setStep(1);
  };

  const reset = () => {
    setStep(0); setTranscript(""); setCart([]); setAddress(""); setOmName(""); setOmManual(false);
    setCustomerName(""); setCompany(""); setEmail(""); setPhone("");
    setCodeOverride(""); setCodeManual(false); setShipping("FREESHIP"); setNotes(""); setParseError("");
  };

  const updateQty   = (id, d) => setCart(prev => prev.map(i => i.id===id ? {...i,qty:Math.max(0,i.qty+d)} : i).filter(i=>i.qty>0));
  const swapHeight  = (oldId, newId) => {
    const newProd = ALL_PRODUCTS.find(p => p.id===newId);
    if (!newProd) return;
    setCart(prev => prev.map(i => i.id===oldId ? {...i,...newProd,qty:i.qty,color:i.color} : i));
  };
  const updateColor = (id, c) => setCart(prev => prev.map(i => i.id===id ? {...i,color:c} : i));
  const addProduct  = p => { if (!cart.find(c=>c.id===p.id)) setCart(prev=>[...prev,{...p,qty:1,color:COLOR_IDS.has(p.id)?"Black":null}]); };
  const removeItem  = id => setCart(prev => prev.filter(i=>i.id!==id));

  // â”€â”€ Order Sheet â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (step === 2) {
    return (
      <div style={{minHeight:"100vh",padding:"24px 16px",background:"linear-gradient(135deg,#fff7ed,#fef3c7)"}}>
        <RegionToggle region={region} onChange={handleRegionSwitch} locked />
        <div style={{maxWidth:620,margin:"0 auto",background:"#fff",borderRadius:20,padding:"32px 28px",
          boxShadow:"0 8px 40px rgba(0,0,0,0.1)",border:"1px solid #fed7aa"}}>

          <div style={{textAlign:"center",marginBottom:24}}>
            <div style={{width:56,height:56,background:"#16a34a",borderRadius:"50%",fontSize:26,
              display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",
              margin:"0 auto 12px",fontWeight:700}}>âœ“</div>
            <h2 style={{fontSize:22,fontWeight:700,color:"#1c1917",marginBottom:6}}>Order Sheet Ready</h2>
            <p style={{fontSize:13,color:"#6b7280",fontFamily:"sans-serif",lineHeight:1.5}}>
              {cartUrl ? "Cart is pre-loaded â€” items, color, promo code, and shipping address all filled in."
                       : "Some items need manual store links below."}
            </p>
          </div>

          {cartUrl && (
            <a href={cartUrl} target="_blank" rel="noopener noreferrer" style={{
              display:"block",width:"100%",background:"#16a34a",color:"#fff",borderRadius:12,
              padding:"14px 20px",textDecoration:"none",fontSize:15,fontFamily:"sans-serif",
              fontWeight:700,textAlign:"center",marginBottom:16,letterSpacing:"0.2px"}}>
              ğŸ›’ Open Pre-loaded Cart â†’
            </a>
          )}

          {missingItems.length > 0 && (
            <div style={{background:"#fffbeb",border:"1.5px solid #fcd34d",borderRadius:10,
              padding:"12px 16px",marginBottom:14}}>
              <div style={{fontSize:11,fontWeight:700,color:"#92400e",fontFamily:"sans-serif",
                marginBottom:8,textTransform:"uppercase",letterSpacing:"0.4px"}}>âš ï¸ Add manually</div>
              {missingItems.map(item => (
                <div key={item.id} style={{display:"flex",alignItems:"center",gap:10,marginBottom:6}}>
                  <span>{item.icon}</span>
                  <span style={{flex:1,fontSize:13,fontFamily:"sans-serif"}}>{item.qty}Ã— {item.name}{item.color?` (${item.color})`:""}</span>
                  <a href={item.url} target="_blank" rel="noopener noreferrer"
                    style={{background:"#f97316",color:"#fff",borderRadius:7,padding:"5px 10px",
                      textDecoration:"none",fontSize:11,fontFamily:"sans-serif",fontWeight:600}}>Open â†’</a>
                </div>
              ))}
            </div>
          )}

          {/* Summary */}
          <div style={{background:"#f9fafb",borderRadius:10,padding:"14px 16px",marginBottom:16}}>
            {[["OM",omName],["Customer",customerName],["Salon",company],["Email",email],["Phone",phone]].map(([l,v]) =>
              v ? <div key={l} style={{display:"flex",gap:12,marginBottom:6,fontSize:13,fontFamily:"sans-serif"}}>
                <span style={{fontWeight:700,color:"#9ca3af",minWidth:64,fontSize:11,
                  textTransform:"uppercase",letterSpacing:"0.4px"}}>{l}</span>
                <span>{v}</span>
              </div> : null
            )}
            <div style={{display:"flex",gap:12,marginBottom:6,fontSize:13,fontFamily:"sans-serif"}}>
              <span style={{fontWeight:700,color:"#9ca3af",minWidth:64,fontSize:11,textTransform:"uppercase",letterSpacing:"0.4px"}}>Code</span>
              <span style={{fontFamily:"monospace",fontWeight:700,color:"#f97316"}}>{displayCode}</span>
            </div>
            <div style={{display:"flex",gap:12,marginBottom:6,fontSize:13,fontFamily:"sans-serif"}}>
              <span style={{fontWeight:700,color:"#9ca3af",minWidth:64,fontSize:11,textTransform:"uppercase",letterSpacing:"0.4px"}}>Shipping</span>
              <span style={{fontFamily:"monospace",fontWeight:700,color:"#0ea5e9"}}>{shippingObj.code}</span>
            </div>
            {shipping !== "FREESHIP" && (
              <div style={{background:shipping==="2DAYSHIP"?"#fff1f2":"#fffbeb",border:"1.5px solid",
                borderColor:shipping==="2DAYSHIP"?"#fca5a5":"#fcd34d",borderRadius:8,
                padding:"8px 12px",marginBottom:6,fontSize:12,fontFamily:"sans-serif",
                color:shipping==="2DAYSHIP"?"#991b1b":"#92400e",fontWeight:600}}>
                {shipping==="2DAYSHIP"
                  ? "âš¡ RUSH â€” Contact support to confirm 2-day delivery"
                  : "ğŸšš 3-day shipping â€” Contact support to confirm"}
              </div>
            )}
            <div style={{display:"flex",gap:12,fontSize:13,fontFamily:"sans-serif"}}>
              <span style={{fontWeight:700,color:"#9ca3af",minWidth:64,fontSize:11,textTransform:"uppercase",letterSpacing:"0.4px"}}>Ship To</span>
              <span>{address}</span>
            </div>
          </div>

          {cart.map(item => (
            <div key={item.id} style={{display:"flex",alignItems:"center",gap:12,
              padding:"10px 0",borderBottom:"1px solid #f3f4f6"}}>
              <span style={{fontSize:20}}>{item.icon}</span>
              <div style={{flex:1}}>
                <div style={{fontWeight:600,fontSize:13,display:"flex",alignItems:"center",gap:6}}>
                  {item.qty}Ã— {item.name}
                  {item.badge && <span style={{fontSize:9,fontWeight:700,background:"#e0f2fe",color:"#0369a1",
                    borderRadius:4,padding:"2px 5px",fontFamily:"sans-serif"}}>{item.badge}</span>}
                </div>
                <div style={{fontSize:11,color:"#9ca3af",fontFamily:"sans-serif",display:"flex",alignItems:"center",gap:4}}>
                  {item.subtitle}
                  {item.color && <><span>Â·</span><ColorDot color={item.color}/><span>{item.color}</span></>}
                </div>
              </div>
              <span style={{fontWeight:700,fontSize:13,fontFamily:"sans-serif"}}>${(item.price*item.qty).toFixed(2)}</span>
            </div>
          ))}

          {notes && <div style={{background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:8,
            padding:"10px 14px",fontSize:12,fontFamily:"sans-serif",color:"#15803d",margin:"12px 0"}}>
            <strong>Notes:</strong> {notes}
          </div>}

          <div style={{display:"flex",justifyContent:"space-between",borderTop:"2px solid #fed7aa",
            paddingTop:12,marginTop:8,fontSize:14,fontFamily:"sans-serif"}}>
            <span>Total</span><span style={{fontWeight:700,fontSize:18}}>${total.toFixed(2)}</span>
          </div>
          <div style={{fontSize:12,color:"#16a34a",marginTop:4,fontFamily:"sans-serif"}}>âœ“ POS hardware free with promo code</div>

          <div style={{display:"flex",gap:10,marginTop:20}}>
            <button onClick={() => setStep(1)} style={{flex:1,background:"#f3f4f6",color:"#374151",border:"none",
              borderRadius:10,padding:"12px",fontSize:14,fontFamily:"sans-serif",cursor:"pointer"}}>â† Edit Order</button>
            <button onClick={reset} style={{flex:1,background:"#fff7ed",color:"#f97316",border:"1.5px solid #fed7aa",
              borderRadius:10,padding:"12px",fontSize:14,fontFamily:"sans-serif",cursor:"pointer",fontWeight:600}}>+ New Order</button>
          </div>
        </div>
      </div>
    );
  }

  // â”€â”€ Main layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return (
    <div style={{minHeight:"100vh",padding:"24px 16px",background:"linear-gradient(135deg,#fff7ed,#fef3c7)"}}>

      {/* Header */}
      <div style={{maxWidth:720,margin:"0 auto 16px",display:"flex",alignItems:"center",
        justifyContent:"space-between",flexWrap:"wrap",gap:12}}>
        <div style={{display:"flex",alignItems:"center",gap:10}}>
          <span style={{fontSize:28}}>ğŸ¥­</span>
          <span style={{fontSize:18,fontWeight:700,color:"#1c1917",letterSpacing:"-0.5px"}}>OM Equipment Ordering</span>
        </div>
        <div style={{display:"flex",alignItems:"center",gap:6}}>
          {["Transcript","Review & Order"].map((label,i) => (
            <div key={i} style={{display:"flex",alignItems:"center",gap:6}}>
              <div style={{width:24,height:24,borderRadius:"50%",display:"flex",alignItems:"center",
                justifyContent:"center",fontSize:11,fontWeight:700,fontFamily:"sans-serif",
                background:i<=step?"#f97316":"#e5e7eb",color:i<=step?"#fff":"#9ca3af"}}>{i+1}</div>
              <span style={{fontSize:12,fontFamily:"sans-serif",fontWeight:500,
                color:i===step?"#f97316":i<step?"#111":"#9ca3af"}}>{label}</span>
              {i<1 && <div style={{width:16,height:2,background:"#e5e7eb",marginLeft:4}}/>}
            </div>
          ))}
        </div>
      </div>

      <RegionToggle region={region} onChange={handleRegionSwitch} />

      <div style={{maxWidth:720,margin:"0 auto",background:"#fff",borderRadius:16,padding:"28px 28px",
        boxShadow:"0 4px 24px rgba(0,0,0,0.07)",border:"1px solid #fed7aa"}}>

        {/* â”€â”€ STEP 0: TRANSCRIPT â”€â”€ */}
        {step === 0 && (<>
          <h2 style={{fontSize:20,fontWeight:700,color:"#1c1917",marginBottom:6}}>Paste Call Summary or Notes</h2>
          <p style={{fontSize:13,color:"#6b7280",marginBottom:18,lineHeight:1.6,fontFamily:"sans-serif"}}>
            Paste the OB summary or describe what's needed. The app will extract equipment, customer info, address, and shipping.
          </p>
          <textarea
            style={{width:"100%",border:"1.5px solid #e5e7eb",borderRadius:10,padding:"14px 16px",
              fontSize:13,fontFamily:"sans-serif",lineHeight:1.6,color:"#1c1917",resize:"vertical",
              outline:"none",marginBottom:12,minHeight:180}}
            placeholder={'Summary (OB-1)\n* Key Contact: Alex Rivera\n* Order Equipment: Ship short, white iPad stand\n* Address: 1313 Disneyland Dr, Anaheim CA 92802'}
            value={transcript}
            onChange={e => setTranscript(e.target.value)}
          />
          {parseError && <div style={{color:"#dc2626",fontSize:13,marginBottom:10,fontFamily:"sans-serif"}}>{parseError}</div>}
          <button onClick={handleParse} style={{background:"#f97316",color:"#fff",border:"none",borderRadius:10,
            padding:"13px 28px",fontSize:15,fontWeight:700,fontFamily:"sans-serif",cursor:"pointer",letterSpacing:"0.2px"}}>
            Parse & Build Order â†’
          </button>
        </>)}

        {/* â”€â”€ STEP 1: REVIEW + PLACE ORDER â”€â”€ */}
        {step === 1 && (<>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}>
            <h2 style={{fontSize:20,fontWeight:700,color:"#1c1917"}}>Review & Place Order</h2>
            <button onClick={() => setStep(0)} style={{fontSize:12,color:"#9ca3af",background:"none",
              border:"none",cursor:"pointer",fontFamily:"sans-serif"}}>â† Back</button>
          </div>

          {/* OM & Client Info */}
          <div style={{background:"#fafafa",border:"1.5px solid #f3f4f6",borderRadius:12,
            padding:"16px 18px",marginBottom:22}}>
            <div style={{fontSize:10,fontWeight:700,color:"#9ca3af",textTransform:"uppercase",
              letterSpacing:"0.6px",fontFamily:"sans-serif",marginBottom:12}}>OM & Client Info</div>

            {/* OM pills */}
            <Field label="OM Name *">
              <div style={{display:"flex",flexWrap:"wrap",gap:7,marginBottom: omName&&!OM_NAMES.includes(omName)?6:0}}>
                {OM_NAMES.map(name => (
                  <button key={name} onClick={() => {setOmName(name);setOmManual(true);setCodeManual(false);}} style={{
                    padding:"5px 14px",borderRadius:999,fontSize:13,fontFamily:"sans-serif",cursor:"pointer",
                    fontWeight:omName===name?700:400,
                    border:omName===name?"2px solid #f97316":"1.5px solid #e5e7eb",
                    background:omName===name?"#fff7ed":"#fafafa",
                    color:omName===name?"#f97316":"#374151",
                  }}>{name}</button>
                ))}
              </div>
              {omName && !OM_NAMES.includes(omName) && (
                <div style={{fontSize:11,color:"#9ca3af",fontFamily:"sans-serif",marginTop:4}}>
                  Auto-detected: <strong>{omName}</strong> â€” select above to override
                </div>
              )}
            </Field>

            {/* Customer + Salon */}
            <div style={{display:"flex",gap:14,flexWrap:"wrap"}}>
              <Field label="Customer Name">
                <Input value={customerName} onChange={e=>setCustomerName(e.target.value)} placeholder="Courtney Gray"/>
              </Field>
              <Field label="Salon / Business">
                <Input value={company} onChange={e=>setCompany(e.target.value)} placeholder="Serenity Day Spa LLC"/>
              </Field>
            </div>

            {/* Email + Phone */}
            <div style={{display:"flex",gap:14,flexWrap:"wrap"}}>
              <Field label="Email">
                <Input type="email" value={email} onChange={e=>setEmail(e.target.value)} placeholder="courtney@salon.com"/>
              </Field>
              <Field label="Phone">
                <Input type="tel" value={phone} onChange={e=>setPhone(e.target.value)} placeholder="(805) 555-0123"/>
              </Field>
            </div>

            {/* Promo code */}
            <Field label={<>Promo Code * {!codeManual&&omName&&<span style={{fontSize:10,color:"#9ca3af",fontWeight:400,textTransform:"none",letterSpacing:0}}> auto-generated</span>}</>}>
              <div style={{position:"relative"}}>
                <Input
                  style={{fontFamily:"monospace",letterSpacing:1.5,paddingRight:34,
                    borderColor:displayCode&&!codeValid?"#fca5a5":displayCode&&codeValid?"#86efac":"#e5e7eb",
                    background:displayCode&&codeValid?"#f0fdf4":"#fff"}}
                  value={displayCode}
                  onChange={e=>{setCodeOverride(e.target.value.toUpperCase().replace(/\s/g,""));setCodeManual(true);}}
                  placeholder="MARISSAMANGOMINT"
                />
                {displayCode && <span style={{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",fontSize:14}}>
                  {codeValid?"âœ…":"âš ï¸"}
                </span>}
              </div>
              {displayCode&&!codeValid && <div style={{fontSize:11,color:"#dc2626",marginTop:3,fontFamily:"sans-serif"}}>
                Format: NAMEMANGOMINT â€” e.g. MARISSAMANGOMINT
              </div>}
              {codeManual && <button onClick={()=>{setCodeManual(false);setCodeOverride("");}}
                style={{marginTop:4,fontSize:11,color:"#9ca3af",background:"none",border:"none",
                  cursor:"pointer",fontFamily:"sans-serif",padding:0}}>â†© Reset to auto-generated</button>}
            </Field>
          </div>

          {/* Cart */}
          {cart.length === 0 && <div style={{color:"#9ca3af",fontStyle:"italic",fontFamily:"sans-serif",
            marginBottom:16,fontSize:13}}>No items detected â€” add below.</div>}

          {cart.map(item => (
            <div key={item.id} style={{display:"flex",alignItems:"center",gap:12,
              padding:"12px 0",borderBottom:"1px solid #f3f4f6"}}>
              <span style={{fontSize:22}}>{item.icon}</span>
              <div style={{flex:1}}>
                <div style={{display:"flex",alignItems:"center",gap:6,fontWeight:600,fontSize:14}}>
                  {item.name}
                  {item.badge && <span style={{fontSize:9,fontWeight:700,background:"#e0f2fe",color:"#0369a1",
                    borderRadius:4,padding:"2px 5px",fontFamily:"sans-serif"}}>{item.badge}</span>}
                </div>
                <div style={{fontSize:12,color:"#9ca3af",fontFamily:"sans-serif"}}>{item.subtitle} â€” ${item.price.toFixed(2)} ea</div>
                {COLOR_IDS.has(item.id) && (
                  <div style={{display:"flex",flexWrap:"wrap",gap:12,marginTop:6,alignItems:"center"}}>
                    <div style={{display:"flex",gap:7,alignItems:"center"}}>
                      <span style={{fontSize:10,color:"#9ca3af",fontFamily:"sans-serif",textTransform:"uppercase"}}>Color:</span>
                      {["Black","White"].map(c => (
                        <button key={c} onClick={()=>updateColor(item.id,c)} style={{
                          display:"flex",alignItems:"center",gap:4,padding:"3px 10px",borderRadius:999,
                          fontSize:12,fontFamily:"sans-serif",cursor:"pointer",
                          border:item.color===c?"2px solid #f97316":"1.5px solid #e5e7eb",
                          background:item.color===c?"#fff7ed":"#f9fafb",
                          color:item.color===c?"#f97316":"#374151",fontWeight:item.color===c?700:400,
                        }}><ColorDot color={c}/>{c}</button>
                      ))}
                    </div>
                    {(item.id==="complete-display-tall"||item.id==="complete-display-short") && (
                      <div style={{display:"flex",gap:7,alignItems:"center"}}>
                        <span style={{fontSize:10,color:"#9ca3af",fontFamily:"sans-serif",textTransform:"uppercase"}}>Height:</span>
                        {["Tall","Short"].map(h => {
                          const targetId = "complete-display-" + h.toLowerCase();
                          const active = item.id===targetId;
                          return <button key={h} onClick={()=>swapHeight(item.id, targetId)} style={{
                            padding:"3px 10px",borderRadius:999,fontSize:12,fontFamily:"sans-serif",cursor:"pointer",
                            border:active?"2px solid #f97316":"1.5px solid #e5e7eb",
                            background:active?"#fff7ed":"#f9fafb",
                            color:active?"#f97316":"#374151",fontWeight:active?700:400,
                          }}>{h}</button>;
                        })}
                      </div>
                    )}
                  </div>
                )}
              </div>
              <div style={{display:"flex",alignItems:"center",gap:8,background:"#f9fafb",borderRadius:8,padding:"4px 10px"}}>
                <button onClick={()=>updateQty(item.id,-1)} style={{background:"none",border:"none",fontSize:18,
                  cursor:"pointer",color:"#f97316",fontWeight:700,lineHeight:1}}>âˆ’</button>
                <span style={{fontSize:14,fontWeight:700,minWidth:20,textAlign:"center",fontFamily:"sans-serif"}}>{item.qty}</span>
                <button onClick={()=>updateQty(item.id,+1)} style={{background:"none",border:"none",fontSize:18,
                  cursor:"pointer",color:"#f97316",fontWeight:700,lineHeight:1}}>+</button>
              </div>
              <span style={{fontWeight:700,fontFamily:"sans-serif",minWidth:56,textAlign:"right"}}>
                ${(item.price*item.qty).toFixed(2)}
              </span>
              <button onClick={()=>removeItem(item.id)} style={{background:"none",border:"none",
                color:"#d1d5db",cursor:"pointer",fontSize:14,padding:"0 4px"}}>âœ•</button>
            </div>
          ))}

          {/* Add items */}
          <div style={{marginTop:16,marginBottom:22}}>
            <div style={{fontSize:11,fontWeight:700,color:"#9ca3af",textTransform:"uppercase",
              letterSpacing:"0.5px",marginBottom:8,fontFamily:"sans-serif"}}>
              Add items ({region==="US"?"ğŸ‡ºğŸ‡¸ US":"ğŸ‡¨ğŸ‡¦ Canada"}):
            </div>
            <div style={{display:"flex",flexWrap:"wrap",gap:7}}>
              {getProducts(region).filter(p=>!cart.find(c=>c.id===p.id)).map(p => (
                <button key={p.id} onClick={()=>addProduct(p)} style={{
                  background:"#fff7ed",border:"1.5px solid #fed7aa",borderRadius:8,
                  padding:"6px 12px",fontSize:12,cursor:"pointer",color:"#1c1917",
                  fontFamily:"sans-serif",display:"flex",alignItems:"center",gap:4}}>
                  {p.icon} {p.name}
                  {p.badge && <span style={{fontSize:9,background:"#e0f2fe",color:"#0369a1",borderRadius:3,padding:"1px 4px"}}>{p.badge}</span>}
                  {COLOR_IDS.has(p.id) && <span style={{fontSize:10,color:"#9ca3af"}}>Â· B/W</span>}
                  <span style={{color:"#f97316",fontWeight:700}}>+</span>
                </button>
              ))}
            </div>
          </div>

          {/* Shipping address */}
          <Field label="Shipping Address *">
            <Input value={address} onChange={e=>setAddress(e.target.value)}
              placeholder={region==="US"?"1313 Disneyland Dr, Anaheim CA 92802":"100 King St W, Toronto ON M5X 1A9"}/>
          </Field>

          {/* Shipping speed */}
          <div style={{marginBottom:18}}>
            <div style={{fontSize:11,fontWeight:700,color:"#374151",marginBottom:8,fontFamily:"sans-serif",
              textTransform:"uppercase",letterSpacing:"0.4px"}}>Shipping Speed</div>
            <div style={{display:"flex",gap:10,flexWrap:"wrap"}}>
              {SHIPPING_OPTIONS.map(opt => (
                <button key={opt.code} onClick={()=>setShipping(opt.code)} style={{
                  flex:1,minWidth:130,padding:"11px 12px",borderRadius:10,cursor:"pointer",textAlign:"left",
                  border:shipping===opt.code?"2px solid #0ea5e9":"1.5px solid #e5e7eb",
                  background:shipping===opt.code?"#f0f9ff":"#fafafa",
                }}>
                  <div style={{fontSize:16,marginBottom:2}}>{opt.icon}</div>
                  <div style={{fontWeight:700,fontSize:12,color:shipping===opt.code?"#0369a1":"#1c1917",fontFamily:"sans-serif"}}>{opt.label}</div>
                  <div style={{fontSize:10,color:"#9ca3af",fontFamily:"sans-serif",marginBottom:3}}>{opt.sub}</div>
                  <div style={{fontFamily:"monospace",fontSize:11,fontWeight:700,color:shipping===opt.code?"#0ea5e9":"#9ca3af"}}>{opt.code}</div>
                </button>
              ))}
            </div>
          </div>

          {/* Notes */}
          <Field label="Notes">
            <textarea style={{width:"100%",border:"1.5px solid #e5e7eb",borderRadius:8,
              padding:"9px 12px",fontSize:13,fontFamily:"sans-serif",color:"#1c1917",
              outline:"none",resize:"vertical",minHeight:52}}
              value={notes} onChange={e=>setNotes(e.target.value)} placeholder="Anything elseâ€¦"/>
          </Field>

          {/* Total + CTA */}
          <div style={{display:"flex",justifyContent:"space-between",borderTop:"2px solid #fed7aa",
            paddingTop:14,marginTop:4,fontSize:14,fontFamily:"sans-serif"}}>
            <span>Order Total</span>
            <span style={{fontWeight:700,fontSize:20}}>${total.toFixed(2)}</span>
          </div>
          <div style={{fontSize:11,color:"#16a34a",marginTop:3,marginBottom:16,fontFamily:"sans-serif"}}>
            âœ“ POS hardware free with promo code &nbsp;Â·&nbsp; Shipping: {shippingObj.code}
          </div>

          <button
            onClick={() => setStep(2)}
            disabled={!canProceed}
            style={{width:"100%",background:canProceed?"#16a34a":"#d1d5db",color:"#fff",border:"none",
              borderRadius:12,padding:"14px",fontSize:16,fontWeight:700,fontFamily:"sans-serif",
              cursor:canProceed?"pointer":"not-allowed",letterSpacing:"0.2px",transition:"background 0.2s"}}>
            {cartUrl ? "ğŸ›’ Generate Cart Link â†’" : "ğŸ“‹ Generate Order Sheet â†’"}
          </button>

          {!canProceed && <div style={{fontSize:11,color:"#f97316",marginTop:8,fontFamily:"sans-serif",textAlign:"right"}}>
            {cart.length===0&&"Add at least one item. "}
            {!address.trim()&&"Enter a shipping address. "}
            {!codeValid&&"Select an OM to generate promo code. "}
          </div>}
        </>)}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
